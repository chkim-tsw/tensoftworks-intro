# 쇼핑몰 쿠폰 & 포인트 시스템 설계 및 이맥스 연동 가이드

**TenSoftworks | 2026년 2월**

> 본 문서는 쇼핑몰 내 쿠폰 시스템과 포인트 시스템의 독립적 설계 구조와, 이맥스(Emax) 연동 시 고려해야 할 기술적·정책적 사항을 정리한 고객 설명 자료입니다.

---

## 1. 시스템 개요

쿠폰 시스템과 포인트 시스템은 쇼핑몰 내에서 **각각 독립적으로 운영**되면서도, 쇼핑몰 정책 엔진에 의해 **통합적으로 관리**됩니다. 두 시스템의 분리는 확장성, 유지보수성, 그리고 운영사 손해 방지 측면에서 필수적입니다.

| 구분 | 쿠폰 시스템 | 포인트 시스템 |
|------|------------|--------------|
| **목적** | 할인 혜택 제공 (금액/비율 할인) | 고객 충성도 관리 및 리워드 |
| **발행 주체** | 운영사 또는 상품 공급사 | 운영사 또는 시스템 자동 발행 |
| **수명 주기** | 발행 → 다운로드 → 사용 → 소멸 | 적립 → 사용 → 차감 → 소멸 |
| **운영사 비용 부담** | 상품별 할인율 제한으로 통제 가능 | 현금성 자산으로 직접 비용 발생 |
| **핵심 리스크** | 중복 할인 시 마진 잠식 | 무분별 발행 시 운영사 재정 손실 |

> ✅ 두 시스템은 독립적으로 설계되되, 쇼핑몰 정책 엔진을 통해 쿠폰+포인트 동시 적용 정책, 최대 할인한도, 운영사 보호 룰을 통합 관리합니다.

---

## 2. 쿠폰 시스템 상세 설계

### 2-1. 쿠폰 수명 주기 (전주기 추적)

쿠폰은 발행부터 소멸까지 모든 단계가 추적되며, 각 단계별로 운영사 대시보드에서 현황을 확인할 수 있습니다.

| 단계 | 상태 | 설명 | 추적 항목 |
|------|------|------|-----------|
| ① 발행 | `CREATED` | 쿠폰 생성 및 발행 조건 설정 | 발행일, 발행량, 발행 대상, 유형 |
| ② 배포 | `DISTRIBUTED` | 고객에게 쿠폰 전달 (다운로드) | 다운로드일, 다운로드 경로, 고객 ID |
| ③ 사용 | `USED` | 결제 시 쿠폰 적용 완료 | 사용일, 주문번호, 할인 금액 |
| ④ 소멸 | `EXPIRED` | 유효기간 경과 또는 수동 회수 | 소멸일, 소멸 사유, 미사용 통계 |

### 2-2. 쿠폰 유형

| 유형 | 설명 | 예시 | 운영사 영향 |
|------|------|------|------------|
| **정액 할인** | 고정 금액 할인 | 5,000원 할인권 | 비용 예측 용이, 최소 금액 조건 필수 |
| **비율 할인** | 주문금액 대비 % 할인 | 10% 할인 (최대 2만원) | 최대 할인 한도 설정 필수 |
| **무료배송** | 배송비 면제 | 무료배송 쿠폰 | 배송비 부담 주체 명확화 필요 |
| **사은품 쿠폰** | 특정 상품 무료 증정 | 샘플 증정 쿠폰 | 재고 관리 연동 필요 |

### 2-3. 쿠폰 발행 시 필수 설정 항목

- **유효기간**: 발행일 기준 또는 다운로드일 기준 (택 1)
- **사용 조건**: 최소 주문금액, 적용 가능 카테고리/상품
- **중복 사용**: 동일 주문 내 쿠폰 중복 적용 여부
- **1인당 발행 한도**: 동일 쿠폰 최대 보유 수량
- **총 발행 한도**: 전체 발행 수량 상한

### 2-4. 쿠폰 취소/환불 처리

주문 취소 또는 환불 시 쿠폰의 복원 여부는 운영 정책에 따라 설정합니다.

| 시나리오 | 처리 방식 | 비고 |
|---------|----------|------|
| 주문 전체 취소 | 쿠폰 복원 (유효기간 내) | 유효기간 경과 시 소멸 처리 |
| 부분 취소 | 쿠폰 미복원 (기사용 처리) | 할인 혜택은 이미 적용되었으므로 |
| 관리자 수동 환불 | 복원 여부 선택 가능 | 어드민에서 건별 처리 |

---

## 3. 포인트 시스템 상세 설계

### 3-1. 포인트 수명 주기

| 단계 | 설명 | 추적 항목 |
|------|------|-----------|
| **적립** | 구매 확정, 이벤트, 관리자 수동 지급 | 적립일, 적립 사유, 적립 금액, 원천(주문/이벤트/수동) |
| **사용** | 결제 시 포인트 차감 | 사용일, 주문번호, 사용 금액 |
| **차감 (마이너스 발행)** | 오적립 보정, 페널티 | 차감일, 차감 사유, 승인자 |
| **소멸** | 유효기간 경과로 자동 소멸 | 소멸일, 소멸 금액, 사전 안내 여부 |

### 3-2. 포인트 적립 정책

| 적립 유형 | 설명 | 적립 시점 |
|----------|------|----------|
| **구매 적립** | 결제 금액 기준 일정 비율 적립 | 구매 확정 시 (취소 기간 경과 후) |
| **이벤트 적립** | 프로모션, 출석체크 등 | 이벤트 조건 충족 시 즉시 |
| **관리자 지급** | CS 보상, 프로모션 등 수동 | 관리자 승인 즉시 |
| **삼성 연동 적립** | 삼성 구독 서비스 통한 적립 | 삼성 측 데이터 확인 후 |

### 3-3. 마이너스 발행 (차감) 시나리오

> ⚠️ 포인트는 현금성 자산이므로, 운영사 손해를 방지하기 위한 마이너스 발행(차감) 트리거 설계가 반드시 필요합니다.

| 트리거 | 설명 | 처리 방식 |
|--------|------|----------|
| **주문 취소** | 구매 적립 포인트의 원복 | 적립된 포인트 자동 차감 |
| **부분 반품** | 반품 상품에 해당하는 포인트 회수 | 반품 금액 비례 차감 |
| **오적립 보정** | 시스템 오류로 과다 적립 시 | 관리자 수동 차감 (사유 기록 필수) |
| **부정 사용 적발** | 어뷰징, 다중 계정 등 | 전액 차감 + 계정 제재 |
| **포인트 사용 후 환불** | 포인트로 결제 후 주문 취소 | 포인트 복원 또는 차액 환불 정책 필요 |

### 3-4. 포인트 소멸 정책

- **소멸 기간**: 적립일 기준 12개월 (운영사 설정 가능)
- **소멸 예고**: 소멸 30일 전 / 7일 전 자동 안내 (SMS/푸시)
- **FIFO 원칙**: 먼저 적립된 포인트부터 사용 및 소멸 (선입선출)

---

## 4. 운영사 보호를 위한 백그라운드 정책 설계

쇼핑몰 자체적으로 할인이 존재하기 때문에, 쿠폰과 포인트가 추가로 적용될 때 운영사 손해가 발생하지 않도록 하는 정책 엔진이 필요합니다.

### 4-1. 할인 중첩 정책

| 정책 | 설명 | 현재 권장 설정 |
|------|------|---------------|
| **쇼핑몰 할인 + 쿠폰** | 자체 할인 상품에 추가 쿠폰 적용 | ✅ 허용 (단, 최대 할인율 제한) |
| **쇼핑몰 할인 + 포인트** | 자체 할인 상품에 포인트 사용 | ❌ 불가 (현재 정책) |
| **쿠폰 + 포인트** | 쿠폰과 포인트 동시 적용 | 정책 설정에 따라 결정 |
| **쿠폰 + 쿠폰** | 복수 쿠폰 동시 적용 | ❌ 불가 (1주문 1쿠폰 원칙 권장) |

### 4-2. 운영사 손해 방지 트리거

| 트리거 | 작동 조건 | 동작 |
|--------|----------|------|
| **최대 할인율 캡** | 상품 원가 대비 총 할인이 설정 비율 초과 시 | 추가 할인 자동 차단 |
| **일일 포인트 적립 한도** | 1인당 일일 적립 포인트 상한 도달 시 | 추가 적립 중단 |
| **월간 포인트 발행 한도** | 전체 포인트 발행량이 월 예산 초과 시 | 자동 적립 중단 + 관리자 알림 |
| **포인트 사용 시 최소 결제 비율** | 포인트로 결제 전액 사용 방지 | 최소 현금 결제 비율 강제 (예: 30%) |
| **쿠폰 할인 후 마진 체크** | 쿠폰 적용 후 상품 마진이 기준 이하 시 | 쿠폰 적용 불가 처리 |

### 4-3. 정책 우선순위 (결제 시 적용 순서)

```
① 상품 원가 확인
② 쇼핑몰 자체 할인 적용
③ 쿠폰 적용 가능 여부 판단 (중첩 정책 체크)
④ 포인트 사용 가능 여부 판단 (중첩 정책 체크)
⑤ 총 할인율 캡 검증 (운영사 최대 할인율 초과 여부)
⑥ 최종 결제 금액 확정
```

---

## 5. 이맥스(Emax) 연동 시 유의사항

### 5-1. 쿠폰 시스템 연동

| 항목 | 유의사항 | 권장 대응 |
|------|---------|----------|
| **쿠폰 코드 체계** | 이맥스 기존 주문 시스템과 쿠폰 코드 충돌 방지 | 쿠폰 코드에 고유 접두사 부여 (예: `EMX-CPNXXXX`) |
| **할인 금액 전달** | 이맥스 어드민에 쿠폰 할인 금액이 정확히 표기되어야 함 | 주문 데이터에 쿠폰 할인 금액 필드 별도 추가 |
| **쿠폰 비용 부담** | 공급사 부담 vs 운영사 부담 구분 필요 | 쿠폰별 비용 부담 주체 필드 설계 |
| **정산 반영** | 쿠폰 할인분이 정산 시 정확히 차감되어야 함 | 정산 데이터에 쿠폰 할인 항목 분리 표기 |
| **취소 시 복원** | 이맥스 주문 취소 API 호출 시 쿠폰 복원 로직 | 취소 이벤트 웹훅으로 쿠폰 상태 자동 업데이트 |

### 5-2. 포인트 시스템 연동

| 항목 | 유의사항 | 권장 대응 |
|------|---------|----------|
| **포인트 적립 시점** | 이맥스 주문 상태와 포인트 적립 시점 동기화 필수 | 주문 확정(배송 완료+취소기간 경과) 이벤트 기준 적립 |
| **포인트 사용 결제** | 이맥스 결제 시스템에 포인트 차감 금액 반영 | 결제 수단에 "포인트" 항목 추가, 실결제금액과 분리 |
| **취소 시 포인트 처리** | 포인트 사용 주문 취소 시 복원/차감 로직 | 취소 유형별 포인트 복원 룰 사전 정의 |
| **삼성 구독 연동** | 삼성 측 매출 데이터 → 포인트 적립 연계 | 삼성 데이터 확정 후 적립 (수기 확인 프로세스 반영) |
| **마이너스 발행 권한** | 이맥스 어드민에서 관리자 차감 기능 | 차감 시 사유 입력 필수 + 승인 프로세스 |
| **잔액 조회** | 고객 마이페이지 및 어드민에서 실시간 잔액 확인 | API 기반 잔액 조회 엔드포인트 구축 |

### 5-3. 공통 연동 주의사항

| 항목 | 설명 |
|------|------|
| **데이터 정합성** | 쿠폰/포인트 사용 내역과 이맥스 주문 데이터 간 정기적 교차검증 배치 필수 |
| **동시성 처리** | 동일 쿠폰/포인트의 동시 사용 요청 시 Race Condition 방지 (비관적 잠금 또는 큐 처리) |
| **롤백 처리** | 결제 실패 시 쿠폰 복원 및 포인트 환원 트랜잭션 보장 |
| **로그 보관** | 모든 쿠폰/포인트 이벤트 로그 최소 3년 보관 (전자상거래법 준수) |
| **어드민 대시보드** | 이맥스 어드민에서 쿠폰/포인트 현황 조회 화면 추가 개발 필요 |

---

## 6. 삼성 구독 서비스 연동 시 특수 고려사항

삼성 구독 서비스를 통한 유입 고객에 대해 쿠폰/포인트를 제공할 경우, 아래 사항을 추가로 고려해야 합니다.

| 항목 | 현재 상황 | 대응 방안 |
|------|----------|----------|
| **매출 확인 방식** | 삼성 담당자 수기 취합 전달 | 데이터 수신 후 포인트 적립 (자동 적립 불가) |
| **쿠키 기반 추적** | 추적 누락 가능성 존재 | 누락분에 대한 포인트 미적립 정책 수립 |
| **쿠폰 발행 대상** | 삼성 경유 고객 식별 필요 | 삼성 유입 태그 기반 쿠폰 자동 발행 로직 |
| **정산 시차** | 수기 확인으로 실시간 정산 불가 | 포인트 적립 지연 안내 및 확정 후 적립 프로세스 |

> ⚠️ 삼성 측 API 연동이 불가한 현 상태에서는, 포인트 적립을 "삼성 확인 완료 건"에 한해 관리자 수동 또는 CSV 업로드 방식으로 처리하는 것을 권장합니다.

---

## 7. 개발 우선순위 제안

| 우선순위 | 항목 | 설명 | 예상 기간 |
|---------|------|------|----------|
| **1순위** | 정책 엔진 설계 | 할인 중첩 규칙, 최대 할인 캡, 운영사 보호 룰 | 설계 2주 |
| **2순위** | 쿠폰 시스템 코어 | 발행/배포/사용/소멸 전주기 + 어드민 관리 | 개발 3~4주 |
| **3순위** | 포인트 시스템 코어 | 적립/사용/차감/소멸 + 마이너스 발행 | 개발 3~4주 |
| **4순위** | 이맥스 어드민 연동 | 현황 대시보드, 정산 반영, 관리자 기능 | 개발 2~3주 |
| **5순위** | 삼성 연동 포인트 | 삼성 데이터 수신 → 포인트 적립 프로세스 | 개발 1~2주 |

> 정책 엔진이 먼저 설계되어야 쿠폰/포인트 시스템의 제약조건이 확정됩니다. 정책 설계 없이 개발을 시작하면 이후 대규모 수정이 필요할 수 있습니다.

---

## 8. 핵심 요약

1. **쿠폰과 포인트는 독립 시스템**이지만, 정책 엔진을 통해 상호 제약 관계를 관리합니다.
2. **현재 쇼핑몰 자체 할인이 있으므로**, 추가 쿠폰은 허용하되 포인트 사용은 제한하는 방향이 운영사 손해를 최소화합니다.
3. **포인트는 현금성 자산**이므로, 마이너스 발행 트리거와 발행 한도 등 운영사 보호 장치가 반드시 필요합니다.
4. **이맥스 연동 시** 데이터 정합성, 동시성 처리, 롤백 보장이 핵심 기술 과제입니다.
5. **삼성 연동 포인트**는 수기 확인 프로세스의 한계로 인해, 확정 데이터 기반의 후적립 방식을 권장합니다.

---

*본 문서에 대한 문의: TenSoftworks 개발팀*
